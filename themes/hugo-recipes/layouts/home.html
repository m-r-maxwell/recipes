{{ define "main" }}
  {{ with .Params.home_intro }}
    <p class="home-intro">{{ . }}</p>
  {{ else }}
    {{ .Content }}
  {{ end }}

  <section>
    <h2>Recent Recipes</h2>
  {{- $perPage := cond (isset .Site.Params "homePagerSize") (.Site.Params.homePagerSize) 10 -}}
  {{- $coll := where site.RegularPages "Section" "recipes" -}}
  {{- $sorted := $coll.ByDate.Reverse -}}
  {{- $paginator := .Paginate $sorted $perPage -}}
    <ul>
      {{- range $paginator.Pages }}
        <li>
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          <small class="muted">&nbsp;â€” {{ .Section | title }}</small>
          <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
        </li>
      {{- end }}
    </ul>

  {{- if gt $paginator.TotalPages 1 }}
      <nav class="pagination" aria-label="Home pagination">
        {{- if $paginator.HasPrev }}
          <a class="prev" href="{{ $paginator.Prev.URL }}">&larr; Newer</a>
        {{- end }}
        {{- range $paginator.Pagers }}
          {{- if eq . $paginator }}
            <span class="page current">{{ .PageNumber }}</span>
          {{- else }}
            <a class="page" href="{{ .URL }}">{{ .PageNumber }}</a>
          {{- end }}
        {{- end }}
        {{- if $paginator.HasNext }}
          <a class="next" href="{{ $paginator.Next.URL }}">Older &rarr;</a>
        {{- end }}
      </nav>
    {{- end }}
    {{/* Optional: keep a link to the full recipes listing if you want */}}
  </section>
    <section>
      <h2>Recent Snacks</h2>
    {{- $snacksCount := cond (isset .Site.Params "homeSnacksCount") (.Site.Params.homeSnacksCount) 5 -}}
    {{- $snacksColl := where site.RegularPages "Section" "snacks" -}}
    {{- /* We'll output the latest N snacks as JSON for client-side pagination. */ -}}
  {{- $snacks := first 100 ($snacksColl.ByDate.Reverse) -}} {{/* cap to reasonable number for homepage */}}
    <div id="snacks-home" data-per-page="{{ $snacksCount }}">
      <noscript>
        <ul>
          {{- range first $snacksCount $snacks }}
            <li>
              <a href="{{ .RelPermalink }}">{{ .Title }}</a>
              <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
            </li>
          {{- end }}
        </ul>
        {{ with site.GetPage "page" "snacks/all" }}
          <p><a href="{{ .RelPermalink }}">View all snacks</a></p>
        {{ else }}
          {{ with site.GetPage "section" "snacks" }}
            <p><a href="{{ .RelPermalink }}">View all snacks</a></p>
          {{ end }}
        {{ end }}
      </noscript>

      <div id="snacks-list"></div>
      <nav id="snacks-pagination" class="pagination" aria-label="Snacks pagination" hidden></nav>
    </div>

    {{- /* Output snacks as JSON using a slice + jsonify then mark safe for JS to avoid HTML-escaping */ -}}
    {{- $items := slice -}}
    {{- range $s := $snacks -}}
      {{- $items = $items | append (dict "title" $s.Title "url" $s.RelPermalink "date" ($s.Date.Format "Jan 2, 2006")) -}}
    {{- end -}}
    <script id="snacks-data" type="application/json">{{ $items | jsonify | safeJS }}</script>

  <script src="{{ "js/snacks-home-pagination.js" | relURL }}" defer></script>
    </section>
{{ end }}
